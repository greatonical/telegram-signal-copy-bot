# Telegram Signal Reader & Forwarder - Development Guide

## Project Overview

Build a Telegram userbot (client-based automation) that:
- Authenticates as a real Telegram user (not a bot)
- Monitors a signal group/channel for new messages
- Automatically reads and captures message content
- Forwards signals to a target channel/group

**Current Phase:** Simple relay system (read ‚Üí forward)  
**Future Phases:** Signal parsing, trade execution, analytics

---

## ‚ö†Ô∏è Important Warnings

- **TOS Risk:** Userbots violate Telegram's Terms of Service. Use a secondary/throwaway account.
- **Rate Limits:** Telegram restricts automated actions. Behave human-like to avoid bans.
- **Security:** Session files = full account access. Protect them like passwords.
- **Testing:** Create a new account with a cheap SIM, let it age for a week before automating.

---

## Tech Stack

| Component | Technology | Reason |
|-----------|------------|--------|
| **Language** | Python 3.11+ | Best Telegram client library support |
| **Telegram Client** | Telethon | Most stable MTProto implementation |
| **Config Management** | `.env` file + python-dotenv | Secure credential storage |
| **Logging** | Python `logging` module | Debug and monitor activity |
| **Deployment** | Linux VPS (DigitalOcean/Hetzner) | 24/7 uptime |
| **Process Manager** | systemd or Docker | Auto-restart on crashes |

**No database needed for Phase 1.** Add later when tracking/analytics required.

---

## Project Structure

```
telegram-signal-bot/
‚îú‚îÄ‚îÄ main.py                 # Main bot script
‚îú‚îÄ‚îÄ config.py               # Configuration (group IDs, settings)
‚îú‚îÄ‚îÄ .env                    # API credentials (NEVER commit)
‚îú‚îÄ‚îÄ .gitignore              # Ignore .env, .session, logs/
‚îú‚îÄ‚îÄ requirements.txt        # Python dependencies
‚îú‚îÄ‚îÄ README.md               # Project documentation
‚îú‚îÄ‚îÄ logs/                   # Log files directory
‚îÇ   ‚îî‚îÄ‚îÄ bot.log             # Application logs
‚îî‚îÄ‚îÄ sessions/               # Telegram session files
    ‚îî‚îÄ‚îÄ user.session        # Auto-generated by Telethon
```

**What each file does:**

- `main.py` - Core bot logic (connect, listen, forward)
- `config.py` - Group IDs, delays, feature flags
- `.env` - API_ID, API_HASH, phone number
- `requirements.txt` - Telethon and dependencies
- `sessions/user.session` - Keeps you logged in (encrypted by Telethon)

---

## Phase 1: Core Features (MVP)

### ‚úÖ Must Have

1. **User Authentication**
   - Login with phone number + OTP
   - Store session securely
   - Handle 2FA if enabled

2. **Message Listener**
   - Monitor specific group/channel
   - Capture new text messages
   - Ignore system messages (joins, pins, etc.)

3. **Message Forwarder**
   - Send to target group/channel
   - Copy message (don't show original sender)
   - Add rate limiting delay (1-2 seconds)

4. **Error Handling**
   - Catch FloodWait errors (rate limit)
   - Auto-reconnect on disconnect
   - Log errors to file

5. **Logging**
   - Timestamp all actions
   - Log message IDs forwarded
   - Track errors and warnings

### üö´ Not Included (Yet)

- Signal parsing/extraction
- Database storage
- Multi-group support
- Message editing detection
- Media handling (images, files)

---

## Prerequisites

### 1. Get Telegram API Credentials

**Not from BotFather.** This is different.

1. Go to: https://my.telegram.org
2. Login with your phone number
3. Navigate to "API Development Tools"
4. Create a new application
5. Save your:
   - `API_ID` (integer, e.g., 12345678)
   - `API_HASH` (string, e.g., "a1b2c3d4...")

### 2. Prepare Test Account

**Critical:** Don't use your main Telegram account.

- Get a cheap SIM card or virtual number
- Create new Telegram account
- Use it normally for 5-7 days (send messages, join groups)
- Then use it for automation

This "aging" reduces ban risk.

### 3. Get Group/Channel IDs

You need numeric IDs for:
- **Source group** (where signals come from)
- **Target group** (where you forward to)

**How to find:**
- Use a Telegram ID bot like `@userinfobot`
- Or extract from Telethon itself (it shows IDs when you join)

Format: `-1001234567890` (negative for groups/channels)

---

## Implementation Steps

### Step 1: Environment Setup

```bash
# Create project directory
mkdir telegram-signal-bot
cd telegram-signal-bot

# Create virtual environment
python3 -m venv venv
source venv/bin/activate  # On Windows: venv\Scripts\activate

# Install dependencies
pip install telethon python-dotenv
pip freeze > requirements.txt

# Create necessary directories
mkdir logs sessions
```

### Step 2: Configuration Files

**Create `.env` file:**
```env
API_ID=12345678
API_HASH=your_api_hash_here
PHONE_NUMBER=+1234567890
```

**Create `.gitignore`:**
```
.env
*.session
*.session-journal
logs/
__pycache__/
venv/
```

**Create `config.py`:**
```python
import os
from dotenv import load_dotenv

load_dotenv()

# Telegram API Credentials
API_ID = int(os.getenv('API_ID'))
API_HASH = os.getenv('API_HASH')
PHONE_NUMBER = os.getenv('PHONE_NUMBER')

# Group/Channel IDs
SOURCE_GROUP_ID = -1001234567890  # Replace with actual ID
TARGET_GROUP_ID = -1009876543210  # Replace with actual ID

# Bot Settings
FORWARD_DELAY = 2  # Seconds between forwards (anti-spam)
SESSION_NAME = 'sessions/user'  # Session file location

# Logging
LOG_FILE = 'logs/bot.log'
LOG_LEVEL = 'INFO'  # DEBUG, INFO, WARNING, ERROR
```

### Step 3: Core Bot Logic (`main.py`)

**Key components:**

1. **Initialize Telethon client**
2. **Login handler** (first run only)
3. **New message event handler**
4. **Message filter** (text only, ignore system)
5. **Forward function** with delay
6. **Error handling** (FloodWait, disconnects)
7. **Logging setup**

**Flow:**
```
Start ‚Üí Connect to Telegram ‚Üí Listen for new messages in SOURCE_GROUP
‚Üí Filter message (text only) ‚Üí Forward to TARGET_GROUP (with delay)
‚Üí Log action ‚Üí Repeat
```

### Step 4: First Run & Testing

```bash
# Activate virtual environment
source venv/bin/activate

# Run the bot
python main.py
```

**What happens on first run:**
1. Asks for phone number
2. Telegram sends OTP code
3. Enter code in terminal
4. If 2FA enabled, enter password
5. Session file created in `sessions/`
6. Bot starts listening

**Subsequent runs:** No OTP needed, uses session file.

### Step 5: Testing Strategy

1. **Local test first:**
   - Run on your laptop
   - Monitor 1 test group
   - Forward to private test channel
   - Check logs for errors

2. **Verify behaviors:**
   - New message appears ‚Üí forwarded within 2 seconds
   - System messages ignored (user joined, pinned, etc.)
   - Edited messages handled properly
   - No crashes on disconnect

3. **Rate limit test:**
   - Send 5 messages quickly
   - Ensure delay between forwards
   - Check for FloodWait errors

### Step 6: Deployment to VPS

```bash
# On your VPS (Ubuntu/Debian)
sudo apt update
sudo apt install python3 python3-pip python3-venv git

# Clone/upload your project
git clone <your-repo>
cd telegram-signal-bot

# Setup
python3 -m venv venv
source venv/bin/activate
pip install -r requirements.txt

# Copy .env file with credentials

# Test run
python main.py
```

**Keep it running 24/7:**

Option A - systemd service (recommended):
```bash
sudo nano /etc/systemd/system/telegram-bot.service
# Add service configuration
sudo systemctl enable telegram-bot
sudo systemctl start telegram-bot
```

Option B - screen/tmux:
```bash
screen -S telegram-bot
python main.py
# Ctrl+A+D to detach
```

Option C - Docker (advanced):
```bash
# Create Dockerfile
docker build -t telegram-bot .
docker run -d --restart unless-stopped telegram-bot
```

---

## Error Handling Patterns

### Common Errors & Solutions

| Error | Cause | Solution |
|-------|-------|----------|
| `FloodWaitError` | Sending too fast | Implement exponential backoff |
| `SessionPasswordNeededError` | 2FA enabled | Prompt for password on login |
| `ChannelPrivateError` | Not member of group | Join group first |
| `ConnectionError` | Network issues | Auto-reconnect logic |
| `RPCError` | Generic API error | Log and continue |

### Flood Wait Handling

```python
# When Telegram says "wait X seconds"
try:
    await client.send_message(...)
except FloodWaitError as e:
    wait_time = e.seconds
    # Log: "Rate limited, waiting {wait_time} seconds"
    await asyncio.sleep(wait_time)
    # Retry
```

---

## Security Best Practices

1. **Session File Protection:**
   - Never commit `.session` files to Git
   - Set file permissions: `chmod 600 sessions/user.session`
   - Backup securely (encrypted)

2. **Credential Management:**
   - Use `.env` for all secrets
   - Add `.env` to `.gitignore`
   - Use environment variables on VPS

3. **Account Safety:**
   - Use secondary account, not main
   - Don't join too many groups quickly (max 3-5/day)
   - Space out actions (2-3 second delays)
   - Monitor for warning messages from Telegram

4. **Code Safety:**
   - Don't log sensitive data (phone, hash)
   - Use try/except for all Telegram calls
   - Implement graceful shutdown (Ctrl+C)

---

## Logging & Monitoring

### What to Log

**INFO level:**
- Bot started/stopped
- Message forwarded (with IDs)
- Group joined/left

**WARNING level:**
- Rate limit hit
- Connection dropped
- Retry attempts

**ERROR level:**
- Unhandled exceptions
- Failed forwards
- Authentication issues

### Log Format Example

```
2026-01-30 14:32:15 - INFO - Bot started, monitoring group -1001234567890
2026-01-30 14:35:22 - INFO - Message 12345 forwarded to -1009876543210
2026-01-30 14:36:10 - WARNING - FloodWait: waiting 15 seconds
2026-01-30 14:38:45 - ERROR - Failed to forward: ChannelPrivateError
```

### Monitoring Script Health

Simple health check:
- Check if process is running
- Check last log timestamp (should be recent)
- Check session file exists
- Optional: Send daily summary to your private channel

---

## Future Enhancements (Post-MVP)

### Phase 2: Signal Parsing
**When:** After basic forwarding works reliably

**Add:**
- Regex patterns to extract trade data
- Parse: pair, direction (BUY/SELL), entry, stop-loss, take-profit
- Validate signal format
- Reformat messages for clarity

**Example:**
```
Input:  "üî• BUY BTCUSDT @ 43500 | SL: 43000 | TP: 45000"
Output: Structured dict with parsed values
```

### Phase 3: Database Integration
**When:** Need history, deduplication, or analytics

**Add:**
- SQLite or PostgreSQL
- Store: message_id, timestamp, content, forwarded_status
- Track edited signals
- Prevent duplicate forwards

**Schema idea:**
```sql
signals (
    id, message_id, group_id, timestamp, 
    content, parsed_data, forwarded, edited
)
```

### Phase 4: Advanced Features

**Multi-group Support:**
- Monitor 5-10 signal groups
- Tag source in forwarded message
- Filter by quality/reputation

**Edit Detection:**
- Detect when original signal is edited
- Update forwarded message
- Alert users to changes

**Media Handling:**
- Forward images with signals
- Extract text from images (OCR)
- Handle charts/screenshots

**Filtering & Intelligence:**
- Only forward signals with specific keywords
- Filter by sender (only trusted admins)
- Ignore low-quality signals

**Analytics Dashboard:**
- Track signal performance
- Win rate per group
- Best time-of-day patterns

**Auto-Trading Integration:**
- Parse signal ‚Üí send to trading bot API
- Risk management rules
- Position sizing logic

### Phase 5: Scalability

**When:** Managing 10+ groups or serving users

**Add:**
- Message queue (RabbitMQ/Redis)
- Multiple userbot instances
- Load balancing
- Web dashboard for config
- User subscription system

---

## Telegram API Rate Limits

**Know these to avoid bans:**

| Action | Limit |
|--------|-------|
| Messages sent | ~30/second (burst), ~20/second (sustained) |
| Group joins | ~5-10/day for new accounts |
| File downloads | Varies by size |
| API calls | ~1000/day (soft limit) |

**How to stay safe:**
- Add 1-2 second delays between forwards
- Don't join many groups on day 1
- Randomize delays slightly (1.5-2.5s vs exactly 2s)
- Implement exponential backoff on errors

---

## Troubleshooting Guide

### Bot won't start
- Check `.env` file exists and has correct values
- Verify session file isn't corrupted
- Check Python version (3.11+)
- Review logs for specific error

### Not receiving messages
- Verify you're a member of source group
- Check group ID is correct (negative number)
- Ensure group allows member messages
- Confirm bot is actually connected (check logs)

### Messages not forwarding
- Verify target group ID correct
- Check you have send permissions in target
- Look for FloodWait errors in logs
- Ensure delay between messages implemented

### Session expired
- Delete `.session` file
- Run again, re-authenticate
- Check if account was banned/restricted

### High CPU/Memory usage
- Telethon is generally lightweight
- Check for infinite loops in code
- Review log file size (rotate logs)
- Monitor with `htop` or `top`

---

## Development Workflow

### Daily Development

```bash
# Activate environment
source venv/bin/activate

# Make code changes
nano main.py

# Test locally
python main.py

# Check logs
tail -f logs/bot.log

# Stop (Ctrl+C)

# Deploy to VPS
git push
# SSH to VPS
ssh user@your-vps
cd telegram-signal-bot
git pull
sudo systemctl restart telegram-bot
```

### Version Control

```bash
git init
git add .
git commit -m "Initial bot setup"
git remote add origin <your-repo>
git push -u origin main
```

**What to commit:**
- ‚úÖ `main.py`, `config.py`, `requirements.txt`
- ‚úÖ `README.md`, `.gitignore`
- ‚ùå `.env`, `.session`, `logs/`

---

## Testing Checklist

Before deploying to VPS:

- [ ] Bot connects successfully
- [ ] Receives messages from source group
- [ ] Forwards to target group
- [ ] System messages ignored
- [ ] Delay between forwards working
- [ ] FloodWait handled gracefully
- [ ] Logs created and readable
- [ ] Can stop/start without errors
- [ ] Session persists across restarts
- [ ] No sensitive data in logs

---

## Resources & Documentation

**Official Docs:**
- Telethon: https://docs.telethon.dev/
- Telegram API: https://core.telegram.org/api
- MTProto Protocol: https://core.telegram.org/mtproto

**Helpful Guides:**
- Telethon QuickStart: https://docs.telethon.dev/en/stable/basic/quick-start.html
- Event handling: https://docs.telethon.dev/en/stable/modules/events.html
- Session management: https://docs.telethon.dev/en/stable/concepts/sessions.html

**Community:**
- Telethon Telegram Group: @TelethonChat
- Stack Overflow: Tag `telethon`

---

## Quick Reference: Key Concepts

### Bot vs Userbot

| Feature | Bot (BotFather) | Userbot (This Project) |
|---------|----------------|------------------------|
| Authentication | Bot token | Phone + OTP |
| Capabilities | Limited API | Full user API |
| Can join private groups | ‚ùå (needs invite link) | ‚úÖ |
| Can read all messages | ‚ùå (only mentions/commands) | ‚úÖ |
| Shows as bot | ‚úÖ | ‚ùå (shows as user) |
| TOS compliant | ‚úÖ | ‚ùå |

### Message Types

```python
# Text message
message.text

# Message with media
message.photo, message.video, message.document

# Edited message
message.edit_date

# Forwarded message
message.forward

# System message (ignore these)
message.action (user joined, pinned, etc.)
```

### Group IDs

- Private groups: `-100` + numbers (e.g., `-1001234567890`)
- Public groups: `@username` or ID
- Channels: Same as groups
- Users: Positive integers

---

## Final Notes

### Start Simple
- Get basic forwarding working first
- Don't over-engineer Phase 1
- Add features incrementally

### Test Thoroughly
- Use throwaway account
- Test in private groups first
- Monitor for 24 hours before trusting

### Stay Updated
- Telethon updates regularly
- Telegram API changes occasionally
- Star the Telethon repo for updates

### Be Responsible
- Don't spam
- Respect rate limits
- Use for personal automation only
- Don't sell access (violates TOS)

---

## Next Steps

1. **Get API credentials** from my.telegram.org
2. **Prepare test account** (new SIM, age it)
3. **Set up local environment** (Python, venv, Telethon)
4. **Create project structure** (folders, files)
5. **Implement Phase 1** (connect, listen, forward)
6. **Test locally** (verify all features work)
7. **Deploy to VPS** (24/7 operation)
8. **Monitor & iterate** (check logs, fix issues)

---

**Good luck building! Start with Phase 1, get it stable, then expand from there.**
